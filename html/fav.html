<!doctype html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>المفضلة - Motor Fix (أبيض)</title>
    <!-- Font Awesome 6 -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <!-- unified design: white nav & hero, no recently viewed section -->
    <style>
      /* === ROOT VARIABLES (same palette, but header/hero white) === */
      :root {
        --primary: #000000;
        --secondary: #333333;
        --accent: #666666;
        --light: #ffffff;
        --gray-light: #f5f5f5;
        --gray: #e0e0e0;
        --bg-primary: #ffffff;
        --bg-secondary: #f8f9fa;
        --border: #ddd;
        --border-light: #eee;
        --text-primary: #000000;
        --text-secondary: #333333;
        --text-muted: #666666;
        --success: #28a745;
        --danger: #dc3545;
        --warning: #ffc107;
        --info: #17a2b8;
        --primary-hover: #333333;
        --danger-hover: #c82333;
        --success-hover: #218838;
        --footer-text: #bdc3c7;
        --social-bg: rgba(255, 255, 255, 0.1);
        --overlay-bg: rgba(0, 0, 0, 0.8);
        --shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        --shadow-hover: 0 5px 20px rgba(0, 0, 0, 0.15);
        --transition: all 0.3s ease;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family:
          system-ui,
          -apple-system,
          "Segoe UI",
          Roboto,
          sans-serif;
      }
      body {
        background-color: var(--gray-light);
        line-height: 1.6;
      }

      /* === HEADER : WHITE === */
      .header {
        background: white;
        color: var(--text-primary);
        box-shadow: 0 2px 15px rgba(0, 0, 0, 0.05);
        position: sticky;
        top: 0;
        z-index: 1000;
        border-bottom: 1px solid var(--border-light);
      }
      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
      }
      .navbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        height: 70px;
      }
      .logo h1 a {
        color: var(--primary);
        text-decoration: none;
        font-size: 1.8rem;
        font-weight: 700;
        letter-spacing: 1px;
      }
      .nav-links {
        display: flex;
        gap: 25px;
        list-style: none;
        align-items: center;
      }
      .nav-links a {
        color: var(--text-secondary);
        text-decoration: none;
        font-weight: 500;
        transition: var(--transition);
        padding: 5px 0;
        border-bottom: 2px solid transparent;
      }
      .nav-links a:hover,
      .nav-links a.active {
        border-bottom-color: var(--danger);
        color: var(--danger);
      }
      .cart-icon,
      .favorite-icon {
        position: relative;
      }
      .cart-icon a,
      .favorite-icon a {
        display: flex;
        color: var(--text-primary);
      }
      .cart-count,
      .favorite-count {
        position: absolute;
        top: -8px;
        right: -8px;
        background: var(--danger);
        color: white;
        border-radius: 50%;
        width: 18px;
        height: 18px;
        font-size: 0.7rem;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .mobile-menu-btn {
        display: none;
        font-size: 1.5rem;
        cursor: pointer;
        color: var(--primary);
      }
      @media (max-width: 992px) {
        .mobile-menu-btn {
          display: block;
        }
        .nav-links {
          display: none;
          position: absolute;
          top: 70px;
          right: 0;
          left: 0;
          background: white;
          flex-direction: column;
          padding: 20px;
          gap: 15px;
          border-top: 1px solid var(--border);
          box-shadow: var(--shadow);
        }
        .nav-links.active {
          display: flex;
        }
      }

      /* === PAGE HEADER : WHITE (with subtle gray) === */
      .page-header {
        background: white;
        padding: 40px 0;
        text-align: center;
        border-bottom: 1px solid var(--border-light);
      }
      .page-header h1 {
        font-size: 2.5rem;
        margin-bottom: 10px;
        color: var(--primary);
      }
      .breadcrumb {
        display: flex;
        gap: 8px;
        justify-content: center;
        color: var(--text-muted);
      }
      .breadcrumb a {
        color: var(--text-secondary);
        text-decoration: none;
      }
      .breadcrumb a:hover {
        color: var(--danger);
      }

      /* === FAVORITES SECTION === */
      .section-padding {
        padding: 60px 0;
      }
      .favorites-header {
        margin-bottom: 40px;
        background: white;
        border-radius: 20px;
        padding: 30px;
        box-shadow: var(--shadow);
        border: 1px solid var(--border-light);
      }
      .favorites-header-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 20px;
      }
      .favorites-title {
        display: flex;
        align-items: center;
        gap: 15px;
      }
      .favorites-title i {
        font-size: 2rem;
        color: var(--danger);
        background: rgba(220, 53, 69, 0.1);
        padding: 15px;
        border-radius: 50%;
      }
      .favorites-title h2 {
        font-size: 1.8rem;
        color: var(--primary);
      }
      .favorites-title h2 span {
        color: var(--danger);
        margin: 0 5px;
        font-weight: bold;
      }
      .favorites-actions {
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
      }
      .btn {
        padding: 12px 28px;
        border: none;
        border-radius: 50px;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
        display: inline-flex;
        align-items: center;
        gap: 10px;
        font-size: 1rem;
        text-decoration: none;
      }
      .btn-primary {
        background: var(--primary);
        color: white;
      }
      .btn-primary:hover {
        background: var(--primary-hover);
        transform: translateY(-3px);
        box-shadow: var(--shadow-hover);
      }
      .btn-outline {
        background: transparent;
        border: 2px solid var(--border);
        color: var(--text-secondary);
      }
      .btn-outline:hover {
        background: var(--danger);
        border-color: var(--danger);
        color: white;
        transform: translateY(-3px);
      }
      .favorites-subtitle {
        margin-top: 15px;
        color: var(--text-muted);
        font-size: 1.1rem;
      }

      /* === FAV GRID === */
      .favorites-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 25px;
        margin-bottom: 50px;
      }
      .fav-card {
        background: white;
        border-radius: 20px;
        overflow: hidden;
        box-shadow: var(--shadow);
        transition: var(--transition);
        border: 1px solid var(--border-light);
        position: relative;
        display: flex;
        flex-direction: column;
        height: 100%;
      }
      .fav-card:hover {
        transform: translateY(-8px);
        box-shadow: var(--shadow-hover);
      }
      .fav-card-badge {
        position: absolute;
        top: 15px;
        right: 15px;
        background: var(--primary);
        color: white;
        padding: 6px 16px;
        border-radius: 30px;
        font-size: 0.8rem;
        font-weight: 600;
        z-index: 2;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
      }
      .fav-card-image {
        position: relative;
        height: 200px;
        overflow: hidden;
        background: #f0f0f0;
      }
      .fav-card-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.6s;
      }
      .fav-card:hover .fav-card-image img {
        transform: scale(1.08);
      }
      .fav-card-actions {
        position: absolute;
        top: 15px;
        left: 15px;
        display: flex;
        flex-direction: column;
        gap: 10px;
        opacity: 0;
        transform: translateX(-10px);
        transition: var(--transition);
      }
      .fav-card:hover .fav-card-actions {
        opacity: 1;
        transform: translateX(0);
      }
      .fav-action-btn {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: white;
        border: none;
        color: var(--text-secondary);
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
        font-size: 1rem;
      }
      .fav-action-btn:hover {
        background: var(--danger);
        color: white;
        transform: scale(1.15);
      }
      .fav-action-btn.cart:hover {
        background: var(--success);
      }
      .fav-card-content {
        padding: 20px;
        flex: 1;
        display: flex;
        flex-direction: column;
      }
      .fav-card-category {
        font-size: 0.8rem;
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 1px;
        margin-bottom: 5px;
      }
      .fav-card-title {
        font-size: 1.2rem;
        margin-bottom: 10px;
        color: var(--primary);
        font-weight: 700;
        line-height: 1.4;
      }
      .fav-card-price {
        display: flex;
        align-items: baseline;
        gap: 10px;
        margin-bottom: 15px;
        flex-wrap: wrap;
      }
      .current-price {
        font-size: 1.5rem;
        font-weight: 800;
        color: var(--danger);
      }
      .old-price {
        color: var(--text-muted);
        text-decoration: line-through;
        font-size: 1rem;
      }
      .fav-card-meta {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding-top: 15px;
        border-top: 1px solid var(--border);
        margin-top: auto;
        font-size: 0.9rem;
      }
      .in-stock {
        color: var(--success);
        display: flex;
        align-items: center;
        gap: 5px;
        font-weight: 500;
      }
      .out-of-stock {
        color: var(--danger);
        display: flex;
        align-items: center;
        gap: 5px;
      }
      .fav-card-rating {
        display: flex;
        align-items: center;
        gap: 5px;
        background: #f8f9fa;
        padding: 4px 10px;
        border-radius: 30px;
      }
      .fav-card-rating i {
        color: var(--warning);
        font-size: 0.8rem;
      }
      .fav-card-rating span {
        color: var(--text-muted);
        font-weight: 600;
      }

      /* === EMPTY STATE === */
      .empty-favorites {
        text-align: center;
        padding: 80px 20px;
        background: white;
        border-radius: 30px;
        border: 2px dashed var(--border);
      }
      .empty-state-icon i {
        font-size: 6rem;
        color: var(--danger);
        opacity: 0.5;
        margin-bottom: 20px;
      }
      .empty-favorites h3 {
        font-size: 2rem;
        color: var(--primary);
        margin-bottom: 10px;
      }
      .empty-favorites p {
        font-size: 1.2rem;
        color: var(--text-muted);
        margin-bottom: 30px;
      }
      .empty-state-actions {
        display: flex;
        gap: 20px;
        justify-content: center;
        flex-wrap: wrap;
      }

      /* === FOOTER (unchanged, dark) === */
      .footer {
        background: var(--primary);
        color: white;
        padding: 60px 0 20px;
        margin-top: 60px;
      }
      .footer-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 40px;
        margin-bottom: 40px;
      }
      .footer-col h3,
      .footer-col h4 {
        margin-bottom: 20px;
        color: white;
      }
      .footer-col p {
        color: var(--footer-text);
        line-height: 1.8;
      }
      .social-links {
        display: flex;
        gap: 15px;
        margin-top: 20px;
      }
      .social-links a {
        width: 40px;
        height: 40px;
        background: var(--social-bg);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        transition: var(--transition);
      }
      .social-links a:hover {
        background: var(--danger);
        transform: translateY(-3px);
      }
      .footer-col ul {
        list-style: none;
      }
      .footer-col ul li {
        margin-bottom: 12px;
      }
      .footer-col ul li a {
        color: var(--footer-text);
        text-decoration: none;
        transition: var(--transition);
      }
      .footer-col ul li a:hover {
        color: var(--danger);
        margin-right: 5px;
      }
      .contact-info li {
        display: flex;
        gap: 10px;
        align-items: center;
        color: var(--footer-text);
      }
      .contact-info i {
        width: 20px;
        color: var(--light);
      }
      .footer-bottom {
        border-top: 1px solid var(--footer-border);
        padding-top: 20px;
        text-align: center;
        color: var(--footer-text);
      }
      .developer-credit {
        text-align: center;
        margin-top: 15px;
        color: var(--footer-text);
      }
      .developer-link {
        color: #10697f;
        text-decoration: none;
        font-weight: bold;
        transition: 0.3s;
      }
      .developer-link:hover {
        color: var(--danger);
        text-decoration: none;
      }

      /* === NOTIFICATION === */
      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateX(-100%);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }
      @keyframes slideOut {
        from {
          opacity: 1;
          transform: translateX(0);
        }
        to {
          opacity: 0;
          transform: translateX(-100%);
        }
      }
      .notification {
        position: fixed;
        top: 20px;
        left: 20px;
        padding: 15px 25px;
        border-radius: 50px;
        z-index: 10000;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
        animation: slideIn 0.3s ease;
        display: flex;
        align-items: center;
        gap: 12px;
        font-weight: 500;
        direction: rtl;
      }
      .notification.success {
        background: #d4edda;
        color: #155724;
        border-right: 5px solid #28a745;
      }
      .notification.error {
        background: #f8d7da;
        color: #721c24;
        border-right: 5px solid #dc3545;
      }
      .notification.info {
        background: #333;
        color: white;
        border-right: 5px solid #ffc107;
      }

      /* === RESPONSIVE === */
      @media (max-width: 768px) {
        .favorites-header-content {
          flex-direction: column;
          align-items: flex-start;
        }
        .favorites-actions {
          width: 100%;
        }
        .btn {
          flex: 1;
          justify-content: center;
        }
        .fav-card-actions {
          opacity: 1;
          transform: translateX(0);
        }
      }
      #recentlyViewed {
        display: none !important;
      }
    </style>
    <link rel="icon" href="../favicon.ico" type="image/x-icon" />
  </head>
  <body>
    <!-- Header -->
    <header class="header">
      <div class="container">
        <nav class="navbar">
          <div class="logo">
            <h1><a href="../index.html">Motor Fix</a></h1>
          </div>
          <ul class="nav-links">
            <li><a href="../index.html">الرئيسية</a></li>
            <li><a href="categories.html">التصنيفات</a></li>
            <li><a href="products.html">المنتجات</a></li>
            <li><a href="offers.html">العروض</a></li>
            <li><a href="about.html">عن الشركة</a></li>
            <li><a href="contact.html">اتصل بنا</a></li>
            <li class="cart-icon">
              <a href="cart.html"
                ><i class="fas fa-shopping-cart"></i
                ><span class="cart-count">0</span></a
              >
            </li>
            <li class="favorite-icon">
              <a href="fav.html" class="active"
                ><i class="fas fa-heart"></i
                ><span class="favorite-count">0</span></a
              >
            </li>
          </ul>
          <div class="mobile-menu-btn"><i class="fas fa-bars"></i></div>
        </nav>
      </div>
    </header>

    <!-- Page Header -->
    <section class="page-header">
      <div class="container">
        <div class="page-header-content">
          <h1>المفضلة</h1>
          <div class="breadcrumb">
            <a href="../index.html">الرئيسية</a> <span>/</span>
            <span>المفضلة</span>
          </div>
        </div>
      </div>
    </section>

    <!-- Favorites Section  -->
    <section class="favorites-section section-padding">
      <div class="container">
        <!-- Favorites Header -->
        <div class="favorites-header">
          <div class="favorites-header-content">
            <div class="favorites-title">
              <i class="fas fa-heart"></i>
              <h2>منتجاتك المفضلة <span id="favCountHeader">0</span></h2>
            </div>
            <div class="favorites-actions">
              <button
                class="btn btn-outline"
                id="clearFavoritesBtn"
                style="display: none"
              >
                <i class="fas fa-trash-alt"></i> مسح الكل
              </button>
              <button
                class="btn btn-primary"
                id="addAllToCartBtn"
                style="display: none"
              >
                <i class="fas fa-cart-plus"></i> أضف الكل للسلة
              </button>
            </div>
          </div>
          <p class="favorites-subtitle">
            منتجات قمت بإضافتها إلى المفضلة - يمكنك العودة إليها لاحقاً
          </p>
        </div>

        <!-- Favorites Grid -->
        <div class="favorites-grid" id="favoritesGrid"></div>

        <!-- Empty State -->
        <div class="empty-favorites" id="emptyFavorites" style="display: none">
          <div class="empty-state-icon">
            <i class="fas fa-heart-broken"></i>
          </div>
          <h3>المفضلة فارغة</h3>
          <p>
            لم تقم بإضافة أي منتج إلى المفضلة بعد. تصفح منتجاتنا وأضف ما يعجبك!
          </p>
          <div class="empty-state-actions">
            <a href="products.html" class="btn btn-primary"
              ><i class="fas fa-search"></i> تصفح المنتجات</a
            >
            <a href="offers.html" class="btn btn-outline"
              ><i class="fas fa-tags"></i> العروض الحالية</a
            >
          </div>
        </div>
      </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
      <div class="container">
        <div class="footer-grid">
          <div class="footer-col">
            <h3>Motor Fix</h3>
            <p>
              متجرك الموثوق لقطع غيار السيارات الأصلية بأسعار تنافسية وخدمة
              مميزة في مصر.
            </p>
            <div class="social-links">
              <a href="#"><i class="fab fa-facebook-f"></i></a
              ><a href="#"><i class="fab fa-twitter"></i></a
              ><a href="#"><i class="fab fa-instagram"></i></a
              ><a href="#"><i class="fab fa-whatsapp"></i></a>
            </div>
          </div>
          <div class="footer-col">
            <h4>روابط سريعة</h4>
            <ul>
              <li><a href="../index.html">الرئيسية</a></li>
              <li><a href="categories.html">التصنيفات</a></li>
              <li><a href="products.html">المنتجات</a></li>
              <li><a href="offers.html">العروض</a></li>
              <li><a href="about.html">عن الشركة</a></li>
              <li><a href="contact.html">اتصل بنا</a></li>
            </ul>
          </div>
          <div class="footer-col">
            <h4>سياسات</h4>
            <ul>
              <li><a href="contact.html">سياسة الإرجاع</a></li>
              <li><a href="contact.html">الشروط والأحكام</a></li>
              <li><a href="contact.html">سياسة الخصوصية</a></li>
              <li><a href="contact.html">الدعم الفني</a></li>
              <li><a href="contact.html">الأسئلة الشائعة</a></li>
            </ul>
          </div>
          <div class="footer-col">
            <h4>اتصل بنا</h4>
            <ul class="contact-info">
              <li>
                <i class="fas fa-map-marker-alt"></i
                ><span>كفر الشيخ - مصر</span>
              </li>
              <li><i class="fas fa-phone"></i><span>01013706142</span></li>
              <li>
                <i class="fas fa-envelope"></i><span>abdelkader@gmail.com</span>
              </li>
            </ul>
          </div>
        </div>
        <div class="footer-bottom">
          <p>
            جميع الحقوق محفوظة &copy;
            <span class="current-year">2026</span> Motor Fix
          </p>
        </div>
        <p class="developer-credit">
          تطور
          <a
            href="https://api.whatsapp.com/send?phone=201013706142"
            target="_blank"
            class="developer-link"
            >Abdelkader Mohamed &</a
          >
          <a
            href="https://api.whatsapp.com/send?phone=201010942959"
            target="_blank"
            class="developer-link"
            >Ahmed Nada</a
          >
        </p>
      </div>
    </footer>

    <script>
      (function () {
        let favoriteProducts =
          JSON.parse(localStorage.getItem("favorites")) || [];

        const favGrid = document.getElementById("favoritesGrid");
        const emptyFav = document.getElementById("emptyFavorites");
        const clearBtn = document.getElementById("clearFavoritesBtn");
        const addAllBtn = document.getElementById("addAllToCartBtn");
        const favCountHeader = document.getElementById("favCountHeader");

        function updateAllCounts() {
          const cart = JSON.parse(localStorage.getItem("cart")) || [];
          const cartTotal = cart.reduce((acc, i) => acc + (i.quantity || 1), 0);
          document
            .querySelectorAll(".cart-count")
            .forEach((el) => (el.textContent = cartTotal));
          const favCount = favoriteProducts.length;
          document
            .querySelectorAll(".favorite-count")
            .forEach((el) => (el.textContent = favCount));
          if (favCountHeader) favCountHeader.textContent = favCount;
        }

        function showNotification(msg, type = "info") {
          const n = document.querySelector(".notification");
          if (n) n.remove();
          const notif = document.createElement("div");
          notif.className = `notification ${type}`;
          notif.innerHTML = `<i class="fas ${type === "success" ? "fa-check-circle" : type === "error" ? "fa-exclamation-circle" : "fa-info-circle"}"></i><span>${msg}</span>`;
          document.body.appendChild(notif);
          setTimeout(() => {
            notif.style.animation = "slideOut 0.3s";
            setTimeout(() => notif.remove(), 300);
          }, 3000);
        }

        // Sample data if empty (for attractive preview)
        if (favoriteProducts.length === 0) {
          favoriteProducts = [
            {
              id: 101,
              name: "فلتر زيت محرك",
              price: 120,
              oldPrice: 150,
              image:
                "https://via.placeholder.com/300x200/000000/ffffff?text=فلتر+زيت",
              categoryName: "فلتر",
              inStock: true,
              rating: 4.5,
              reviews: 23,
            },
            {
              id: 102,
              name: "بواجي شرارة (4 حبات)",
              price: 180,
              image:
                "https://via.placeholder.com/300x200/333333/ffffff?text=بواجي",
              categoryName: "كهرباء",
              inStock: true,
              rating: 4.8,
              reviews: 45,
            },
            {
              id: 103,
              name: "ماسحات زجاج أمامي",
              price: 220,
              oldPrice: 270,
              image:
                "https://via.placeholder.com/300x200/111111/ffffff?text=ماسحات",
              categoryName: "اكسسوارات",
              inStock: false,
              rating: 4.2,
              reviews: 12,
            },
            {
              id: 104,
              name: "لمبات LED أمامية",
              price: 350,
              image:
                "https://via.placeholder.com/300x200/222222/ffffff?text=LED",
              categoryName: "إضاءة",
              inStock: true,
              rating: 5.0,
              reviews: 8,
            },
          ];
          localStorage.setItem("favorites", JSON.stringify(favoriteProducts));
        }

        function loadFavorites() {
          favoriteProducts =
            JSON.parse(localStorage.getItem("favorites")) || [];
          if (favCountHeader)
            favCountHeader.textContent = favoriteProducts.length;
          updateAllCounts();

          if (favoriteProducts.length === 0) {
            if (favGrid) favGrid.innerHTML = "";
            if (emptyFav) emptyFav.style.display = "block";
            if (clearBtn) clearBtn.style.display = "none";
            if (addAllBtn) addAllBtn.style.display = "none";
            return;
          } else {
            if (emptyFav) emptyFav.style.display = "none";
            if (clearBtn) clearBtn.style.display = "inline-flex";
            if (addAllBtn) addAllBtn.style.display = "inline-flex";
          }

          favGrid.innerHTML = favoriteProducts
            .map(
              (p) => `
                    <div class="fav-card" data-product-id="${p.id}">
                        <div class="fav-card-badge">${p.categoryName || "قطع غيار"}</div>
                        <div class="fav-card-image">
                            <img src="${p.image}" alt="${p.name}" onerror="this.src='https://via.placeholder.com/300x200/cccccc/000000?text=MotorFix'">
                            <div class="fav-card-actions">
                                <button class="fav-action-btn remove" onclick="removeFav(${p.id})" data-tooltip="إزالة"><i class="fas fa-trash-alt"></i></button>
                                <button class="fav-action-btn cart" onclick="addFavToCart(${p.id})" data-tooltip="أضف للسلة"><i class="fas fa-shopping-cart"></i></button>
                                <button class="fav-action-btn" onclick="viewProd(${p.id})" data-tooltip="عرض التفاصيل"><i class="fas fa-eye"></i></button>
                            </div>
                        </div>
                        <div class="fav-card-content">
                            <div class="fav-card-category">${p.categoryName || "عام"}</div>
                            <h3 class="fav-card-title">${p.name}</h3>
                            <div class="fav-card-price">
                                <span class="current-price">${p.price} جنيه</span>
                                ${p.oldPrice ? `<span class="old-price">${p.oldPrice} جنيه</span>` : ""}
                            </div>
                            <div class="fav-card-meta">
                                <div class="${p.inStock !== false ? "in-stock" : "out-of-stock"}">
                                    <i class="fas ${p.inStock !== false ? "fa-check-circle" : "fa-times-circle"}"></i>
                                    <span>${p.inStock !== false ? "متوفر" : "غير متوفر"}</span>
                                </div>
                                ${p.rating ? `<div class="fav-card-rating"><i class="fas fa-star"></i><span>${p.rating} (${p.reviews || 0})</span></div>` : ""}
                            </div>
                        </div>
                    </div>
                `,
            )
            .join("");
        }

        // Global functions
        window.removeFav = function (productId) {
          favoriteProducts = favoriteProducts.filter((p) => p.id !== productId);
          localStorage.setItem("favorites", JSON.stringify(favoriteProducts));
          loadFavorites();
          updateAllCounts();
          showNotification("تمت الإزالة من المفضلة", "info");
        };

        window.addFavToCart = function (productId) {
          let product = favoriteProducts.find((p) => p.id === productId);
          if (!product) {
            const samples = [
              { id: 101, name: "فلتر زيت محرك", price: 120, image: "" },
              { id: 102, name: "بواجي شرارة", price: 180, image: "" },
            ];
            product = samples.find((s) => s.id === productId);
          }
          if (!product) return;
          let cart = JSON.parse(localStorage.getItem("cart")) || [];
          const exist = cart.find((i) => i.id === productId);
          if (exist) exist.quantity = (exist.quantity || 1) + 1;
          else
            cart.push({
              id: product.id,
              name: product.name,
              price: product.price,
              quantity: 1,
              image: product.image,
            });
          localStorage.setItem("cart", JSON.stringify(cart));
          updateAllCounts();
          showNotification("تمت الإضافة إلى السلة", "success");
        };

        window.viewProd = function (id) {
          alert("عرض تفاصيل المنتج رقم " + id);
        };

        window.clearAllFav = function () {
          if (favoriteProducts.length === 0) return;
          if (confirm("تفريغ المفضلة؟")) {
            favoriteProducts = [];
            localStorage.setItem("favorites", JSON.stringify(favoriteProducts));
            loadFavorites();
            updateAllCounts();
            showNotification("تم تفريغ المفضلة", "success");
          }
        };

        window.addAllToCart = function () {
          if (favoriteProducts.length === 0) {
            showNotification("المفضلة فارغة", "error");
            return;
          }
          let cart = JSON.parse(localStorage.getItem("cart")) || [];
          favoriteProducts.forEach((p) => {
            const exist = cart.find((i) => i.id === p.id);
            if (exist) exist.quantity = (exist.quantity || 1) + 1;
            else
              cart.push({
                id: p.id,
                name: p.name,
                price: p.price,
                quantity: 1,
                image: p.image,
              });
          });
          localStorage.setItem("cart", JSON.stringify(cart));
          updateAllCounts();
          showNotification("أضيفت جميع المنتجات إلى السلة", "success");
        };

        if (clearBtn) clearBtn.addEventListener("click", clearAllFav);
        if (addAllBtn) addAllBtn.addEventListener("click", addAllToCart);

        document
          .querySelector(".mobile-menu-btn")
          ?.addEventListener("click", function () {
            document.querySelector(".nav-links")?.classList.toggle("active");
          });

        document
          .querySelectorAll(".current-year")
          .forEach((el) => (el.textContent = new Date().getFullYear()));

        loadFavorites();
      })();
    </script>
  </body>
</html>
